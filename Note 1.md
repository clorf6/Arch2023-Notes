## TLB(Translation Look-Aside Buffers)

TLB 是一个用于页表缓存的结构。

对于一般的虚拟地址转换为物理地址的操作，我们首先要到主存中去访问对应进程的页表，再根据页表第二次访问主存找到实际的内存地址，整个过程中我们需要两次访问主存。

TLB 则提供了一个缓存的作用。它将部分页表项存起来当作 Cache，这样在转换地址时则可以直接从 TLB 中找到对应的页表项，可以省去一次访存的时间。

TLB 表通常比较小，一般来说不会超过 128-256 个页表项，因此它采用全关联的方法，这样可以充分利用空间，提高命中率。

TLB 中的页表项与主存的页表项存在一些差别。相较于主存中的页表项而言，TLB 中的页表项会额外存储虚拟地址的标志位，因为 CPU 提供的是虚拟地址，需要根据虚拟地址来从 TLB 中查表。因此 TLB 中的页表项比主存的页表项要宽一些，存储的页表项较少，可以用多路比较来查询，这也是为什么选择全关联的一个原因。

![image-20231014140904587](https://clorf-imagehost.oss-cn-shanghai.aliyuncs.com/2023/10/image-20231014140904587-49a861.png)

总结一下，现在 CPU 访存的过程如下：

1. CPU 提供虚拟地址 VA；
2. TLB 根据 VA 查表，如果 hit，则提供物理地址 PA 给 Cache；反之则到主存(Translation)中查找对应页表，找到后转化成物理地址 PA 给 Cache；
3. Cache 根据物理地址 PA 查找数据，如果命中则返回给 CPU，否则到主存中查找数据再返回。

## SPEC(System Performance Evaluation Cooperative)

SPEC 是测试系统总体性能的一个 Benchmark，提供了评价系统结构表现与性能的一套标准，通过运行标准规定的一些程序作为指标。

最初采用 Whetstone 和 Dhrystone 两套程序作为运行的指标，其中 Whetstone 包含大量的浮点运算，Dhrystone 包含大量整数运算。但这两套程序都是人造的，并不自然，通常不能代表现实生活中的程序。因此后来更改标准为更自然的 Nature Select，选择一套常用的程序集来作为指标。其中包含常见的 gcc(测试并行)，spice(包含大量计算)，matrix(包含矢量计算)等等。

如何从结果中总结出系统性能的好坏？根据不同的需求可以采用不同的方法，例如代数平均，调和平均，以及几何平均等等。

## RAID(Redundant Arrays of Inexpensive Disks)

即由数块独立的磁盘来构成一个具有冗余能力的磁盘阵列，可以实现对数据的冗余保护，也能提供更好的 data availability。

![image-20231014150539797](https://clorf-imagehost.oss-cn-shanghai.aliyuncs.com/2023/10/image-20231014150539797-9d29b3.png)

RAID 1(Disk Mirroring) 即磁盘镜像。它对于每一个磁盘都提供了一个对应的镜像在另一个磁盘中。这保证了只要系统中任意一对磁盘中只要有一块可以正常使用，那么系统就能正常运行，即在一块磁盘失效时，系统会转为使用它的镜像磁盘。这种方法具有很好的磁盘冗余能力，能够保证数据绝对安全。然而它的磁盘利用率只有 50%，成本较高。

![image-20231014150610080](https://clorf-imagehost.oss-cn-shanghai.aliyuncs.com/2023/10/image-20231014150610080-c1299b.png)

RAID 3 是带有奇偶校验码的一种并行传送。对于三个以上的磁盘而言，用一个额外的磁盘来存储它们的校验位，即其它磁盘这一位数据的和再模 2(也就是奇偶校验码)。在这种情况下，如果前面的磁盘有一个失效，我们可以通过校验码来还原对应的数据，只要用校验码减去剩下数据的和即可。相较于 RAID 1 而言，它具有更高的容量和传输效率，降低了成本，但是数据可用性变低了。

![image-20231014150639543](https://clorf-imagehost.oss-cn-shanghai.aliyuncs.com/2023/10/image-20231014150639543-dc9df6.png)

RAID 4 的原理和 RAID 3 几乎一样。只是 RAID 3 是把一个数据块分成不同扇区储存在磁盘中，再计算校验码；而 RAID 4 则是把数据块作为单位，对几个数据块计算校验码。相较于 RAID 3，RAID 4 每次读写的容量更高，允许同时对不同磁盘进行独立的读取。

![image-20231014150653637](https://clorf-imagehost.oss-cn-shanghai.aliyuncs.com/2023/10/image-20231014150653637-7615a5.png)

RAID 5 和 RAID 4 也类似，区别在于 RAID 5 把校验码也分段条带化，交叉储存在了不同的磁盘中。相较于 RAID 4，RAID 5 对于 I/O 操作限制更小，因为它把校验码存在了不同磁盘，这样如果有两个对不同数据的写入操作时，它用到的校验码的磁盘是不同的，不会引起冲突。